---
apiVersion: xl-deploy/v1
kind: Applications
spec:
- directory: Applications/move2cloud/my-portal
  children:
  - name: my-portal-aws
    type: udm.Application
    children:
    - name: 1.0.1
      type: udm.DeploymentPackage
      templates:
      - name: template-vm
        type: template.overthere.SshHost
        instanceName: host-{{%publicHostname%}}
        os: UNIX
        address: '{{%publicHostname%}}'
        username: ubuntu
        privateKeyFile: ./ssh/my-portal-keypair-{{env}}.pem
      deployables:
      - name: my-portal-security-group
        type: aws.vpc.SecurityGroupSpec
        securityGroupName: my-portal-security-group
        description: SG for MyPortal
        region: eu-west-3
        inboundRules:
        - name: ssh
          type: aws.vpc.SecurityGroupInboundRuleSpec
          protocol: TCP
          portRange: "22"
          source: 0.0.0.0/0
        - name: http
          type: aws.vpc.SecurityGroupInboundRuleSpec
          protocol: TCP
          portRange: "8080"
          source: 0.0.0.0/0
      - name: my-portal-instance
        type: aws.ec2.InstanceSpec
        amiId: ami-08c757228751c5335
        region: eu-west-3
        securityGroup:
          - my-portal-security-group
        instanceType: t2.micro
        keyName: my-portal-keypair-{{env}}
        instanceTags:
          kind: '{{env}}'
        boundTemplates:
        - ../template-vm
      - name: my-portal-kp
        type: aws.ec2.KeyPairSpec
        region: eu-west-3
        keyPairName: my-portal-keypair-{{env}}
        pemFilePath: ./ssh/my-portal-keypair-{{env}}.pem
